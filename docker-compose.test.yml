version: "3.9"

services:
  navidrome-test:
    container_name: navidrome-test
    image: navidrome-fork:latest
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - GIT_SHA=${GIT_SHA:-dev}
        - GIT_TAG=${GIT_TAG:-0.0.0-fork}
    ports:
      - "4534:4533"
    environment:
      - ND_SCANSCHEDULE=1h
      - ND_LOGLEVEL=debug
      - ND_SESSIONTIMEOUT=24h
      - ND_BASEURL=
      - ND_ENABLEDOWNLOADS=true
      - ND_ENABLETRANSCODINGCONFIG=true
      - ND_MUSICFOLDER=/music
      - ND_DATAFOLDER=/data
    volumes:
      - /share/ZFS20_DATA/Music:/music:ro
      - /share/Container/navidrome-test:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:4533/ping"]
      interval: 30s
      timeout: 10s
      retries: 3
    labels:
      - "com.centurylinklabs.watchtower.enable=false"
